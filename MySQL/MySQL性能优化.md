## MySQL性能优化　　

当今数据库的操作越来越成为整个应用的性能瓶颈，特别是Web应用更加明显。当我们设计数据库和对数据库操作时，都要考虑到性能。

### 1.优化查询语句，方便查询缓存

大多数MySQL服务器都开启了查询缓存，这是提高性能最有效的方案之一，而且这是被MySQL的数据库引擎处理的。当有很多相同的查询被执行多长的时候，这些下次结果会被放到一个缓存中，这样后续相同的查询就不需要操作表，而是直接从缓存中访问结果。

这里最主要的原因是对于程序员来说，这个事情很容易被忽略。因为我们的某些查询语句不会让MySQL生成缓存。如下示例：

```
//查询缓存不开启
select username fromuser where reg_time = CURDATE();

//查询缓存开启
$today = date('Y-m-d');
select username from user where reg_time ='$today';
```

上面两条SQL的区别在于CURDATE\(\)，MySQL的查询缓存对这个函数不起作用，像NOW\(\)、RAND\(\)等等诸如此类的SQL函数都不会开启缓存，因为这些函数的返回是会变的。所以你要用一个变量来代替MySQL的函数，从而开启缓存。

### 2.**EXPLAIN你的SELECT查询**

使用EXPLAIN关键字可以让你知道MySQL是如何处理你的SQL语句的。这可以帮你分析你的查询语句或是表结构的性能瓶颈。EXPLAIN的查询结果还会告诉你你的索引主键被如何利用的，你的数据表是如何被搜索和排序的……等等，等等。

挑一个你的SELECT语句（推荐挑选那个最复杂的，有多表联接的），把关键字EXPLAIN加到前面。

下面这个例子，我们没有给com\_id添加索引：![](http://images2015.cnblogs.com/blog/1022098/201612/1022098-20161230190744726-1300343072.png)![](http://images2015.cnblogs.com/blog/1022098/201612/1022098-20161230190931695-1482338732.png)

当我们给com\_id字段添加索引后

![](http://images2015.cnblogs.com/blog/1022098/201612/1022098-20161230191033132-1794288624.png)

我们可以很明显的看到，前一个搜索结果检索了3592行，而后一个只检索了1行。

### 3.当只要一行数据时使用limit 1

当你查询表的有些时候，你已经知道结果只会有一条结果，但因为你可能需要去fetch游标，或是你也许会去检查返回的记录数。在这种情况下，加上LIMIT 1可以增加性能。这样一样，MySQL数据库引擎会在找到一条数据后停止搜索，而不是继续往后查少下一条符合记录的数据。

### **4.为搜索字段建索引**

索引并不一定就是给主键或是唯一的字段。如果在你的表中，有某个字段你总要会经常用来做搜索，那么为其建立索引。

### 5.在Join表的时候要使用相同类型的列，并将其建立索引

如果你的应用程序有很多JOIN查询，你应该确认两个表中Join的字段是被建过索引的。这样，MySQL内部会启动为你优化Join的SQL语句的机制。

而且，这些被用来Join的字段，应该是相同的类型的。例如：如果你要把DECIMAL字段和一个INT字段Join在一起，MySQL就无法使用它们的索引。对于那些STRING类型，还需要有相同的字符集才行。（两个表的字符集有可能不一样）

### 6.避免select \*

从数据库里读的数据越多，查询执行就越慢。并且，如果你的MySQL服务器和WEB服务器是两个独立的服务器，那么还会增加网络传输的负载。

### 7.永远为每张表设置一个ID

我们应该为数据库里的每张表都设置一个ID做为其主键，而且最好的是一个INT型的（推荐使用UNSIGNED），并设置上自动增加的AUTO\_INCREMENT标志。就算是你users表有一个主键叫“email”的字段，你也别让它成为主键。使用VARCHAR类型来当主键会使用得性能下降。另外，在你的程序中，你应该使用表的ID来构造你的数据结构。而且，在MySQL数据引擎下，还有一些操作需要使用主键，在这些情况下，主键的性能和设置变得非常重要，比如，集群，分区……

在这里，只有一个情况是例外，那就是“关联表”的“外键”，也就是说，这个表的主键，通过若干个别的表的主键构成。我们把这个情况叫做“外键”。比如：有一个“学生表”有学生的ID，有一个“课程表”有课程ID，那么，“成绩表”就是“关联表”了，其关联了学生表和课程表，在成绩表中，学生ID和课程ID叫“外键”其共同组成主键。

### 8.**使用ENUM而不是VARCHAR**

ENUM类型是非常快和紧凑的。在实际上，其保存的是TINYINT，但其外表上显示为字符串。这样一来，用这个字段来做一些选项列表变得相当的完美。如果你有一个字段，比如“性别”，“国家”，“民族”，“状态”或“部门”，你知道这些字段的取值是有限而且固定的，那么，你应该使用ENUM而不是VARCHAR。

MySQL也有一个“建议”（见第9条）告诉你怎么去重新组织你的表结构。当你有一个VARCHAR字段时，这个建议会告诉你把其改成ENUM类型。使用PROCEDURE ANALYSE\(\) 你可以得到相关的建议。

### 9.**从PROCEDURE ANALYSE\(\)取得建议**

PROCEDURE ANALYSE\(\) 会让MySQL帮你去分析你的字段和其实际的数据，并会给你一些有用的建议。只有表中有实际的数据，这些建议才会变得有用，因为要做一些大的决定是需要有数据作为基础的。

例如，如果你创建了一个INT字段作为你的主键，然而并没有太多的数据，那么，PROCEDURE ANALYSE\(\)会建议你把这个字段的类型改成MEDIUMINT。或是你使用了一个VARCHAR字段，因为数据不多，你可能会得到一个让你把它改成ENUM的建议。这些建议，都是可能因为数据不够多，所以决策做得就不够准。

### 10.**尽可能的使用NOT NULL**

除非你有一个很特别的原因去使用NULL值，你应该总是让你的字段保持NOT NULL。首先，问问你自己“Empty”和“NULL”有多大的区别（如果是INT，那就是0和NULL）？如果你觉得它们之间没有什么区别，那么你就不要使用NULL。（你知道吗？在Oracle里，NULL 和 Empty的字符串是一样的！\)

不要以为 NULL 不需要空间，其需要额外的空间，并且，在你进行比较的时候，你的程序会更复杂。当然，这里并不是说你就不能使用NULL了，现实情况是很复杂的，依然会有些情况下，你需要使用NULL值。



